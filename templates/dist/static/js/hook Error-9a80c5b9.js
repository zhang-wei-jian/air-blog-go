import{av as Fe,n as o,aw as Se,p as A,a0 as Te,ax as c,ay as v,P as _e,e as l,w as g,R as N,r as p,az as ae,h as x,aA as te,aa as le,F as U,aB as ne}from"./index-8391854f.js";import{E as se}from"./edit-pen-af58ba35.js";import{d as re}from"./check-3815600c.js";import{r as J,a as Re,b as qe,c as Oe,d as ue,e as Ae,f as He}from"./APIAudioFileDB-163abaae.js";import{r as Me,a as Be,b as ie}from"./APIConfigFile-652f44ec.js";import{b as S}from"./browser-5e8f72a1.js";import{u as Ve}from"./DialplanExtension-9e3aa3b0.js";import"./axios-75d0e659.js";const ze=Ve(),{storeResultData:Le}=Fe(ze);function Xe(){const W=o(!0),H=o(!0),D=o([]),M=o({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let oe=[];o();const f=o(),u=o();function $(e,a){for(const t of e){if(e&&e.includes(a))return{children:e,display:"属性",editable:!1,name:"parent"};if(t.children&&t.children.includes(a))return t;if(t.children){const r=$(t.children,a);if(r)return r}}return null}const ce=(e,a,t)=>{u.value=$(y.value,e),f.value=e};function pe(){const e={name:"",key:Date.now()};Object.keys(f.value).forEach(a=>{e[a]=""}),e.name="new",e.key=Date.now(),u.value.children.push(e);try{c("编辑成功",{type:"success"})}catch{c("编辑失败！",{type:"error"})}}function ve(){if(f.value.type!=="object"){v.error("不是objcet不能添加子");return}const e={name:""};Object.keys(f.value).forEach(a=>{typeof e[a]!="object"&&(e[a]="")}),e.name="new",f.value.children||(f.value.children=[]),f.value.children.push(e);try{reqSetDialplanExtensionTemplate(y.value),c("编辑成功",{type:"success"})}catch{c("编辑失败！",{type:"error"})}}function fe(){if(!u.value.children||!f.value)return;const e=u.value.children.indexOf(f.value);e!==-1&&u.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(y.value),c("编辑成功",{type:"success"})}catch{c("编辑失败！",{type:"error"})}}function de(){if(!u.value||!u.value.children||u.value.children.length<=1){v.warning("子节点不足，无法向上移动");return}const e=u.value.children.indexOf(f.value);if(e<=0){v.warning("当前行已经在顶部，无法再向上移动");return}const a=e-1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(y.value),c("编辑成功",{type:"success"})}catch{c("编辑失败！",{type:"error"})}}function ye(){if(!u.value||!u.value.children||u.value.children.length<=1){v.warning("子节点不足，无法向下移动");return}const e=u.value.children.indexOf(f.value);if(e>=u.value.children.length-1){v.warning("当前行已经在底部，无法再向下移动");return}const a=e+1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(y.value),c("编辑成功",{type:"success"})}catch{c("编辑失败！",{type:"error"})}}async function B(e){H.value=!0;const a=await Me();if(D.value=a.result,e){const t=D.value.findIndex(s=>s===e||s.includes(e));k(D.value[t]);let r=Number(b.value);b.value=String(++r),S.nextTick(()=>{b.value=String(t)})}else{D.value[0]&&k(D.value[0]);let t=Number(b.value);b.value=String(++t),S.nextTick(()=>{b.value="0"})}S.nextTick(()=>{W.value=!1,H.value=!1})}const h=o({}),j=o({}),E=o(-1),T=o(""),y=o(Se(oe,!0)),G=A(()=>(e,a)=>{var t;return(t=h.value[e])==null?void 0:t[a]}),m=A(()=>(e,a)=>{var t,r;return((t=j.value[e])==null?void 0:t.editing)&&a.property===((r=j.value[e])==null?void 0:r.prop)}),_=A(()=>(e,a,t=!1)=>["cursor-pointer","ml-2","transition","delay-100",t?["hover:scale-110","hover:text-red-500"]:m.value(e,a)&&["scale-150","text-red-500"]]);A(()=>(e,a)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);function K(e,a,t){h.value[a]=Object.assign({},h.value[a],{[t.property]:e[t.property]}),j.value[a]=Object.assign({},j.value[a],{editing:!0,prop:t.property})}function V(e,a,t){E.value=a,T.value=t.property}function z(e){var a;T.value="",(a=h.value[e])!=null&&a.value?E.value=e:E.value=-1}function Q(e,a,t){h.value[a][t]=e}const L=o(!1);let R=null;const k=async e=>{X.value=e;const a=await Be(e),t=Object.keys(a.result);M.value=JSON.parse(JSON.stringify(a.result[t[0]])),w.value=M.value,L.value=!1,R&&R(),R=_e(w,()=>{L.value=!0,S.nextTick(()=>{})},{deep:!0}),Le.value=a.result[t[0]]},X=o(""),me=()=>{},he=async(e,a)=>{const t=await ie(e,w.value);v.success(t.message),B(e),k(e)},be=async e=>{const a=e;a.state=!1,w.value=w.value.filter(t=>t.label!==e.label),w.value.push(a)},ge=(e,a)=>{w.value.splice(a,1)},b=o("0"),Ne=async()=>{const e=d.value.name,a=D.value.findIndex(r=>r===e||r.includes(e));k(D.value[a]);let t=Number(b.value);b.value=String(++t),S.nextTick(()=>{b.value=String(a)})},Ie=async()=>{const e=await ie(d.value.name,"");v.success(e.message),B(d.value.name),d.value.name=""},w=o(""),Ce=[{label:"Name",prop:"name",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(U,null,[e.name!="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[e.type==="folder"&&g(l("p",{class:"templateItemText",onClick:()=>I(e[t.property])},[l(p("el-icon"),{color:"#409EFF"},{default:()=>[l(ae,null,null)]}),l("span",null,null),x("    "),l("span",null,null),l("a",null,[x("  "),e[t.property]])]),[[N,!m.value(a,t)]]),e.type==="file"&&g(l("p",{class:"templateItemText"},[l(p("el-icon"),null,{default:()=>[l(te,null,null)]}),l("span",null,null),x("    "),l("span",null,null),e[t.property]]),[[N,!m.value(a,t)]]),l(le,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[g(l(p("el-input"),{modelValue:G.value(a,t.property),onInput:r=>Q(r,a,t.property)},null),[[N,m.value(a,t)]])]}),g(l(p("iconify-icon-offline"),{icon:re,class:_.value(a,t),onClick:()=>Ee(a,e,t.property,e[t.property])},null),[[N,m.value(a,t)]]),g(l(p("iconify-icon-offline"),{icon:se,class:`${_.value(a,!0)} templateEditIcon`,onClick:()=>K(e,a,t)},null),[[N,E.value===a&&!m.value(a,t)&&T.value===t.property]])]),e.name==="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:140px",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[g(l("p",{class:"templateItemText",onClick:()=>I(e[t.property])},[e.type==="folder"&&l(p("el-icon"),{color:"#409EFF"},{default:()=>[l(ae,null,null)]}),e.type==="file"&&l(p("el-icon"),null,{default:()=>[l(te,null,null)]}),l("span",null,null),x("    "),l("span",null,null),l("a",null,[x("  "),e[t.property]])]),[[N,!m.value(a,t)]])])])},{label:"CreateTime",prop:"filemtime",fixed:!0},{label:"Filesize",prop:"filesize",fixed:!0},{label:"Description",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(U,null,[l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[g(l("p",{class:"templateItemText"},[e[t.property]]),[[N,!m.value(a,t)]]),l(le,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[g(l(p("el-input"),{modelValue:G.value(a,t.property),onInput:r=>Q(r,a,t.property)},null),[[N,m.value(a,t)]])]}),g(l(p("iconify-icon-offline"),{icon:re,class:_.value(a,t),onClick:()=>ke(a,e,t.property,e[t.property])},null),[[N,m.value(a,t)]]),g(l(p("iconify-icon-offline"),{icon:se,class:`${_.value(a,!0)} templateEditIcon`,onClick:()=>K(e,a,t)},null),[[N,E.value===a&&!m.value(a,t)&&T.value===t.property]])])])},{label:"Edit",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(U,null,[e.name!="..."&&l("div",null,[e.type==="folder"&&l(p("el-Button"),{size:"small",type:"success",disabled:!0,onClick:()=>ee(e.name),style:"visibility: hidden"},{default:()=>[x("下载")]}),e.type==="file"&&l(p("el-Button"),{size:"small",type:"success",onClick:()=>ee(e.name)},{default:()=>[x("下载")]}),l(p("el-popconfirm"),{title:"您确定要删除?",onConfirm:()=>Z(e)},{reference:()=>l(p("el-button"),{size:"small",type:"danger"},{default:()=>[x("删除")]})})])])}],n=o([""]),I=async(e,a)=>{if(a=="nav"&&n.value[n.value.length-1]===e)return;if(e==="..."){const s=n.value[n.value.length-2],i=await J({dir:s});y.value=i,n.value.pop(),n.value.length>1&&y.value.unshift({name:"...",type:"folder"});return}else if(e===""){const s=await J({dir:e});y.value=s,n.value=[""];return}const t=await J({dir:e});if(y.value=t,y.value.unshift({name:"...",type:"folder"}),n.value[n.value.length-1]!=e)if(n.value.includes(e)){const s=n.value.findIndex(i=>i===e);n.value=n.value.splice(0,s+1)}else n.value.push(e)},d=Te({name:"",description:"",file:""}),De=async e=>{d.description="",d.name="",d.file="",Y.value=[],e==="upload"?O.value=!0:e==="create"&&(q.value=!0)},q=o(!1),O=o(!1),Y=o([]),je=async e=>{e==="upload"?O.value=!1:e==="create"&&(q.value=!1)},we=async e=>{if(e=="upload"){try{const s=n.value[n.value.length-1],i={parent:s,file:d.file,description:d.description},C=await Re(i);v.success(C),await I(s),O.value=!1}catch{c("请求失败",{type:"error"})}return}const a=n.value[n.value.length-1],t={name:"",description:"",parent:a};Object.assign(t,d);const r=await qe(t);v.success(r),await I(a),q.value=!1},xe=async(e,a)=>{d.file=e.raw},Z=async e=>{const a=e.name,t=e.type;let r=n.value[n.value.length-1],s=n.value.join("/");s.startsWith("/")&&(s=s.substring(1));let i={parent:"",name:"",type:""};t==="folder"?i={parent:s+a,name:a,type:t}:t==="file"&&(i={parent:s,name:a,type:t});const C=await Oe(i);v.success(C),await I(r)};async function Ee(e,a,t,r){if(a.type==="folder"){const s=h.value[e][t],i=n.value[n.value.length-1];try{const F={parent:i+"/"+r,newDir:i+"/"+s,name:"",newName:""},P=await ue(F);v.success(P),await I(i)}catch{c("编辑失败！",{type:"error"})}}else if(a.type==="file"){const s=h.value[e][t],i=n.value[n.value.length-1];try{const F=await ue({parent:i,name:r,newName:s});v.success(F),await I(i)}catch{c("编辑失败！",{type:"error"})}}j.value[e]=Object.assign({},j.value[e],{editing:!1,prop:""}),ne().then(()=>h.value[e].value=null)}async function ke(e,a,t,r){const s=h.value[e][t],i=n.value[n.value.length-1];try{const C=i+"/"+name,F={parent:i,name:a.name,description:s},P=await Ae(F);v.success(P),await I(i)}catch{c("编辑失败！",{type:"error"})}j.value[e]=Object.assign({},j.value[e],{editing:!1,prop:""}),ne().then(()=>h.value[e].value=null)}const ee=async e=>{const a=n.value[n.value.length-1];He({name:e,parent:a})};return{CreateDirFileHandle:De,dialogVisible:q,uploadDialogVisible:O,handleClose:je,dialogEnterHandle:we,uploadChange:xe,fileList:Y,nameClickHandle:I,breadcrumbList:n,namesList:D,ItemNameClickHandle:k,DataListResult:M,testHandle:me,save:L,form:d,searchNameHandle:Ne,addNameHandle:Ie,activeCurrent:b,setSave:he,currentName:X,getNames:B,stopWatch:R,treeItemDeleteHandle:be,onItemAddTopHandle:ge,deleteHandle:Z,treeData:w,columns:Ce,dataList:y,rowClickHandle:ce,currentParent:u,currentRow:f,addRow:pe,addRowChilren:ve,deleteRow:fe,moveRowDown:ye,moveRowUp:de,autoExpand:W,loading:H}}export{Xe as useColumns};
