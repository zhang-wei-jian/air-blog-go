import{av as fe,n as c,aw as ye,p as q,ax as y,ay as k,e as a,r,w as s,R as p,aa as T,aN as A,aB as de,P as be,aO as he}from"./index-8391854f.js";import{E as V}from"./edit-pen-af58ba35.js";import{d as B}from"./check-3815600c.js";import{r as me,a as _e,b as K,c as ge}from"./APIConfigFile-652f44ec.js";import{b as x}from"./browser-5e8f72a1.js";import{E as Ie}from"./index-46334353.js";import{u as Ce}from"./DialplanExtension-9e3aa3b0.js";const Ee=Ce();function W(N){return typeof N=="function"||Object.prototype.toString.call(N)==="[object Object]"&&!he(N)}const{storeResultData:je}=fe(Ee);function Oe(){const N=c(!0),L=c(!0),g=c([]),F=c({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let Q=[];const X=[{label:"string",value:"string"},{label:"integer",value:"integer"},{label:"double",value:"double"},{label:"boolean",value:"boolean"},{label:"file",value:"file"},{label:"array",value:"array"},{label:"datetime",value:"datetime"},{label:"date",value:"date"},{label:"time",value:"time"},{label:"wday",value:"wday"}],Y=[{label:"Normal",value:"Normal"},{label:"NoEcho",value:"NoEcho"},{label:"Password",value:"Password"},{label:"PasswordEchoOnEdit",value:"PasswordEchoOnEdit"}],Z=[{label:"boolean",value:"boolean"},{label:"number",value:"number"},{label:"string",value:"string"},{label:"object",value:"object"},{label:"array",value:"array"}];c();const f=c(),o=c();function z(e,t){for(const l of e){if(e&&e.includes(t))return{children:e,display:"属性",editable:!1,name:"parent"};if(l.children&&l.children.includes(t))return l;if(l.children){const n=z(l.children,t);if(n)return n}}return null}const w=(e,t,l)=>{o.value=z(M.value,e),f.value=e};function ee(){const e={name:"",key:Date.now()};Object.keys(f.value).forEach(t=>{e[t]=""}),e.name="new",e.key=Date.now(),o.value.children.push(e);try{y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function te(){if(f.value.type!=="object"){k.error("不是objcet不能添加子");return}const e={name:""};Object.keys(f.value).forEach(t=>{typeof e[t]!="object"&&(e[t]="")}),e.name="new",f.value.children||(f.value.children=[]),f.value.children.push(e);try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function le(){if(!o.value.children||!f.value)return;const e=o.value.children.indexOf(f.value);e!==-1&&o.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ae(){if(!o.value||!o.value.children||o.value.children.length<=1){k.warning("子节点不足，无法向上移动");return}const e=o.value.children.indexOf(f.value);if(e<=0){k.warning("当前行已经在顶部，无法再向上移动");return}const t=e-1;[o.value.children[e],o.value.children[t]]=[o.value.children[t],o.value.children[e]];try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ne(){if(!o.value||!o.value.children||o.value.children.length<=1){k.warning("子节点不足，无法向下移动");return}const e=o.value.children.indexOf(f.value);if(e>=o.value.children.length-1){k.warning("当前行已经在底部，无法再向下移动");return}const t=e+1;[o.value.children[e],o.value.children[t]]=[o.value.children[t],o.value.children[e]];try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}async function H(e){L.value=!0;const t=await me();if(g.value=t.result,e){const l=g.value.findIndex(u=>u===e||u.includes(e));$(g.value[l]);let n=Number(m.value);m.value=String(++n),x.nextTick(()=>{m.value=String(l)})}else{g.value[0]&&$(g.value[0]);let l=Number(m.value);m.value=String(++l),x.nextTick(()=>{m.value="0"})}x.nextTick(()=>{N.value=!1,L.value=!1})}const I=c({}),O=c({}),d=c(-1),_=c(""),M=c(ye(Q,!0)),R=q(()=>(e,t)=>{var l;return(l=I.value[e])==null?void 0:l[t]}),i=q(()=>(e,t)=>{var l,n;return((l=O.value[e])==null?void 0:l.editing)&&t.property===((n=O.value[e])==null?void 0:n.prop)}),v=q(()=>(e,t,l=!1)=>["cursor-pointer","ml-2","transition","delay-100",l?["hover:scale-110","hover:text-red-500"]:i.value(e,t)&&["scale-150","text-red-500"]]);q(()=>(e,t)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);const re=[{label:"编号",prop:"name",hide:function(e,t,l){return!0}},{label:"fueld or application",prop:"field",width:"260",fixed:!0,cellRenderer:({row:e,index:t,column:l})=>a("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"参数名称",prop:"display",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"类型",prop:"type",cellRenderer:({row:e,index:t,column:l})=>{let n;return a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":u=>e[l.property]=u,onChange:u=>D(u,e,t,l)},W(n=Z.map(u=>a(A,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]})}},{label:"help",prop:"help",width:"160",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:e[l.property],placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"默认值",prop:"value",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"edit",prop:"input_type",cellRenderer:({row:e,index:t,column:l})=>{let n;return a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[s(a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":u=>e[l.property]=u,onChange:u=>D(u,e,t,l)},W(n=X.map(u=>a(A,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]}),[[p,e.type!=="object"]])])}},{label:"tristate",prop:"input_tristate",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="boolean"?"":"disable"}  `,onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[s(a(r("el-switch"),{modelValue:e[l.property],"onUpdate:modelValue":n=>e[l.property]=n,class:"ml-2",onChange:n=>D(n,e,t,l)},null),[[p,e.input_type==="boolean"]])])},{label:"min",prop:"input_min",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"?"":"disable"}  ${e.type==="object"?"disable":""}`,onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"max",prop:"input_max",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"?"":"disable"}`,onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])},{label:"echomode",prop:"echomode",cellRenderer:({row:e,index:t,column:l})=>{if(e.type==="object")return a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null);{let n;return a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"||e.input_type==="string"?"":"disable"}`},[s(a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":u=>e[l.property]=u,onChange:u=>D(u,e,t,l)},W(n=Y.map(u=>a(A,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]}),[[p,e.input_type==="integer"||e.input_type==="string"]])])}}},{label:"candidate",prop:"input_candidate",width:"160",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):(e.input_candidate||(e.input_candidate=[]),e.input_type!=="array"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a(Ie,{data:e.input_candidate,onChange:se,onSubmit:n=>D(n.join(","),e,t,l),key:e.input_candidate},null))},{label:"selectonly",prop:"input_selectonly",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="string"||e.input_type==="array"||e.input_candidate.length?"":"disable"}`,onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[s(a(r("el-switch"),{modelValue:e[l.property],"onUpdate:modelValue":n=>e[l.property]=n,class:"ml-2",onChange:n=>D(n,e,t,l)},null),[[p,e.input_type==="string"||e.input_type==="array"||e.input_candidate.length]])])},{label:"column",prop:"input_column",width:"220",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox   ${e.input_type==="array"?"":"disable"}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[s(a("p",{class:"templateItemText"},[e[l.property]]),[[p,!i.value(t,l)]])]}),a(T,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(a(r("el-input"),{modelValue:R.value(t,l.property),onInput:n=>E(n,t,l.property)},null),[[p,i.value(t,l)]])]}),s(a(r("iconify-icon-offline"),{icon:B,class:v.value(t,l),onClick:()=>j(t,e,l.property)},null),[[p,i.value(t,l)]]),s(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[p,d.value===t&&!i.value(t,l)&&_.value===l.property]])])}];function C(e,t,l){I.value[t]=Object.assign({},I.value[t],{[l.property]:e[l.property]}),O.value[t]=Object.assign({},O.value[t],{editing:!0,prop:l.property})}function b(e,t,l){d.value=t,_.value=l.property}function h(e){var t;_.value="",(t=I.value[e])!=null&&t.value?d.value=e:d.value=-1}function E(e,t,l){I.value[t][l]=e}async function j(e,t,l){t[l]=I.value[e][l];try{await reqSetDialplanExtensionTemplate(M.value),y(`编辑成功,${JSON.stringify(I.value[e][l])}`,{type:"success"})}catch{y("编辑失败！",{type:"error"})}O.value[e]=Object.assign({},O.value[e],{editing:!1,prop:""}),de().then(()=>I.value[e].value=null)}const D=async(e,t,l,n)=>{await C(t,l,n),await E(e,l,n.property),await j(l,t,n.property)},se=e=>{},J=c(!1);let P=null;const $=async e=>{G.value=e;const t=await _e(e),l=Object.keys(t.result);F.value=JSON.parse(JSON.stringify(t.result[l[0]])),S.value=F.value,J.value=!1,P&&P(),P=be(S,()=>{J.value=!0,x.nextTick(()=>{})},{deep:!0}),je.value=t.result[l[0]]},G=c(""),pe=()=>{},ie=async(e,t)=>{const l=await K(e,S.value);k.success(l.message),H(e),$(e)},ue=async e=>{const t=e;t.state=!1,S.value=S.value.filter(l=>l.label!==e.label),S.value.push(t)},oe=(e,t)=>{S.value.splice(t,1)},U=c({name:""}),m=c("0"),ce=async()=>{const e=U.value.name,t=g.value.findIndex(n=>n===e||n.includes(e));$(g.value[t]);let l=Number(m.value);m.value=String(++l),x.nextTick(()=>{m.value=String(t)})},ve=async()=>{const e=await K(U.value.name,"");k.success(e.message),H(U.value.name),U.value.name=""},S=c("");return{namesList:g,ItemNameClickHandle:$,DataListResult:F,testHandle:pe,save:J,form:U,searchNameHandle:ce,addNameHandle:ve,activeCurrent:m,setSave:ie,currentName:G,getNames:H,stopWatch:P,treeItemDeleteHandle:ue,onItemAddTopHandle:oe,deleteHandle:async e=>{const t=await ge(e);k.success(t.message),H()},treeData:S,columns:re,dataList:M,rowClickHandle:w,currentParent:o,currentRow:f,addRow:ee,addRowChilren:te,deleteRow:le,moveRowDown:ne,moveRowUp:ae,autoExpand:N,loading:L}}export{Oe as useColumns};
