import{av as Ie,n as r,aw as Ce,p as R,a0 as we,ax as p,ay as d,P as Ee,e as t,w as I,R as C,r as f,az as Q,h as x,aA as X,F as z,aa as je,aB as ke}from"./index-8391854f.js";import{E as Fe}from"./edit-pen-af58ba35.js";import{d as Se}from"./check-3815600c.js";import{r as L,a as Te,b as Re,c as qe,d as He,e as Oe}from"./APIAudioFile-cccadfa5.js";import{r as Ae,a as Me,b as Y}from"./APIConfigFile-652f44ec.js";import{b as j}from"./browser-5e8f72a1.js";import{u as _e}from"./DialplanExtension-9e3aa3b0.js";import"./axios-75d0e659.js";const Be=_e(),{storeResultData:Ve}=Ie(Be);function Ke(){const P=r(!0),q=r(!0),h=r([]),H=r({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let Z=[];r();const o=r(),s=r();function U(e,a){for(const l of e){if(e&&e.includes(a))return{children:e,display:"属性",editable:!1,name:"parent"};if(l.children&&l.children.includes(a))return l;if(l.children){const u=U(l.children,a);if(u)return u}}return null}const ee=(e,a,l)=>{s.value=U(v.value,e),o.value=e};function ae(){const e={name:"",key:Date.now()};Object.keys(o.value).forEach(a=>{e[a]=""}),e.name="new",e.key=Date.now(),s.value.children.push(e);try{p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function le(){if(o.value.type!=="object"){d.error("不是objcet不能添加子");return}const e={name:""};Object.keys(o.value).forEach(a=>{typeof e[a]!="object"&&(e[a]="")}),e.name="new",o.value.children||(o.value.children=[]),o.value.children.push(e);try{reqSetDialplanExtensionTemplate(v.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function te(){if(!s.value.children||!o.value)return;const e=s.value.children.indexOf(o.value);e!==-1&&s.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(v.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function ne(){if(!s.value||!s.value.children||s.value.children.length<=1){d.warning("子节点不足，无法向上移动");return}const e=s.value.children.indexOf(o.value);if(e<=0){d.warning("当前行已经在顶部，无法再向上移动");return}const a=e-1;[s.value.children[e],s.value.children[a]]=[s.value.children[a],s.value.children[e]];try{reqSetDialplanExtensionTemplate(v.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function se(){if(!s.value||!s.value.children||s.value.children.length<=1){d.warning("子节点不足，无法向下移动");return}const e=s.value.children.indexOf(o.value);if(e>=s.value.children.length-1){d.warning("当前行已经在底部，无法再向下移动");return}const a=e+1;[s.value.children[e],s.value.children[a]]=[s.value.children[a],s.value.children[e]];try{reqSetDialplanExtensionTemplate(v.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}async function O(e){q.value=!0;const a=await Ae();if(h.value=a.result,e){const l=h.value.findIndex(i=>i===e||i.includes(e));E(h.value[l]);let u=Number(m.value);m.value=String(++u),j.nextTick(()=>{m.value=String(l)})}else{h.value[0]&&E(h.value[0]);let l=Number(m.value);m.value=String(++l),j.nextTick(()=>{m.value="0"})}j.nextTick(()=>{P.value=!1,q.value=!1})}const N=r({}),w=r({}),k=r(-1),A=r(""),v=r(Ce(Z,!0)),re=R(()=>(e,a)=>{var l;return(l=N.value[e])==null?void 0:l[a]}),b=R(()=>(e,a)=>{var l,u;return((l=w.value[e])==null?void 0:l.editing)&&a.property===((u=w.value[e])==null?void 0:u.prop)}),J=R(()=>(e,a,l=!1)=>["cursor-pointer","ml-2","transition","delay-100",l?["hover:scale-110","hover:text-red-500"]:b.value(e,a)&&["scale-150","text-red-500"]]);R(()=>(e,a)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);function ue(e,a,l){N.value[a]=Object.assign({},N.value[a],{[l.property]:e[l.property]}),w.value[a]=Object.assign({},w.value[a],{editing:!0,prop:l.property})}function M(e,a,l){k.value=a,A.value=l.property}function _(e){var a;A.value="",(a=N.value[e])!=null&&a.value?k.value=e:k.value=-1}function ie(e,a,l){N.value[a][l]=e}const B=r(!1);let F=null;const E=async e=>{W.value=e;const a=await Me(e),l=Object.keys(a.result);H.value=JSON.parse(JSON.stringify(a.result[l[0]])),g.value=H.value,B.value=!1,F&&F(),F=Ee(g,()=>{B.value=!0,j.nextTick(()=>{})},{deep:!0}),Ve.value=a.result[l[0]]},W=r(""),oe=()=>{},ce=async(e,a)=>{const l=await Y(e,g.value);d.success(l.message),O(e),E(e)},pe=async e=>{const a=e;a.state=!1,g.value=g.value.filter(l=>l.label!==e.label),g.value.push(a)},ve=(e,a)=>{g.value.splice(a,1)},m=r("0"),de=async()=>{const e=c.value.name,a=h.value.findIndex(u=>u===e||u.includes(e));E(h.value[a]);let l=Number(m.value);m.value=String(++l),j.nextTick(()=>{m.value=String(a)})},fe=async()=>{const e=await Y(c.value.name,"");d.success(e.message),O(c.value.name),c.value.name=""},g=r(""),me=[{label:"Name",prop:"name",fixed:!0,cellRenderer:({row:e,index:a,column:l})=>t(z,null,[e.name!="..."&&t("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>M(e,a,l),onMouseleave:()=>_(a)},[e.type==="folder"&&I(t("p",{class:"templateItemText",onClick:()=>D(e[l.property])},[t(f("el-icon"),{color:"#409EFF"},{default:()=>[t(Q,null,null)]}),t("span",null,null),x("    "),t("span",null,null),t("a",null,[x("  "),e[l.property]])]),[[C,!b.value(a,l)]]),e.type==="file"&&I(t("p",{class:"templateItemText"},[t(f("el-icon"),null,{default:()=>[t(X,null,null)]}),t("span",null,null),x("    "),t("span",null,null),e[l.property]]),[[C,!b.value(a,l)]])]),e.name==="..."&&t("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:140px",onMouseenter:()=>M(e,a,l),onMouseleave:()=>_(a)},[I(t("p",{class:"templateItemText",onClick:()=>D(e[l.property])},[e.type==="folder"&&t(f("el-icon"),{color:"#409EFF"},{default:()=>[t(Q,null,null)]}),e.type==="file"&&t(f("el-icon"),null,{default:()=>[t(X,null,null)]}),t("span",null,null),x("    "),t("span",null,null),t("a",null,[x("  "),e[l.property]])]),[[C,!b.value(a,l)]])])])},{label:"CreateTime",prop:"filemtime",fixed:!0},{label:"Filesize",prop:"filesize",fixed:!0},{label:"Description",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:l})=>t(z,null,[t("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>M(e,a,l),onMouseleave:()=>_(a)},[I(t("p",{class:"templateItemText"},[e[l.property]]),[[C,!b.value(a,l)]]),t(je,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[I(t(f("el-input"),{modelValue:re.value(a,l.property),onInput:u=>ie(u,a,l.property)},null),[[C,b.value(a,l)]])]}),I(t(f("iconify-icon-offline"),{icon:Se,class:J.value(a,l),onClick:()=>xe(a,e,l.property,e[l.property])},null),[[C,b.value(a,l)]]),I(t(f("iconify-icon-offline"),{icon:Fe,class:`${J.value(a,!0)} templateEditIcon`,onClick:()=>ue(e,a,l)},null),[[C,k.value===a&&!b.value(a,l)&&A.value===l.property]])])])},{label:"Edit",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:l})=>t(z,null,[e.name!="..."&&t("div",null,[e.type==="folder"&&t(f("el-Button"),{size:"small",type:"success",disabled:!0,onClick:()=>K(e.name),style:"visibility: hidden"},{default:()=>[x("下载")]}),e.type==="file"&&t(f("el-Button"),{size:"small",type:"success",onClick:()=>K(e.name)},{default:()=>[x("下载")]}),t(f("el-popconfirm"),{title:"您确定要删除?",onConfirm:()=>G(e.name)},{reference:()=>t(f("el-button"),{size:"small",type:"danger"},{default:()=>[x("删除")]})})])])}],n=r([""]),D=async(e,a)=>{if(a=="nav"&&n.value[n.value.length-1]===e)return;if(e==="..."){const i=n.value[n.value.length-2],y=await L({dir:i});v.value=y,n.value.pop(),n.value.length>1&&v.value.unshift({name:"...",type:"folder"});return}else if(e===""){const i=await L({dir:e});v.value=i,n.value=[""];return}const l=await L({dir:e});if(v.value=l,v.value.unshift({name:"...",type:"folder"}),n.value[n.value.length-1]!=e)if(n.value.includes(e)){const i=n.value.findIndex(y=>y===e);n.value=n.value.splice(0,i+1)}else n.value.push(e)},c=we({name:"",description:"",file:""}),ye=async e=>{c.description="",c.name="",c.file="",$.value=[],e==="upload"?T.value=!0:e==="create"&&(S.value=!0)},S=r(!1),T=r(!1),$=r([]),he=async e=>{e==="upload"?T.value=!1:e==="create"&&(S.value=!1)},be=async e=>{if(e=="upload"){try{const i=n.value[n.value.length-1],y={parent:i,file:c.file,description:c.description},V=await Te(y);d.success(V),await D(i),T.value=!1}catch{p("请求失败",{type:"error"})}return}const a=n.value[n.value.length-1],l={name:"",description:"",parent:a};Object.assign(l,c);const u=await Re(l);d.success(u),await D(a),S.value=!1},ge=async(e,a)=>{c.file=e.raw},G=async e=>{const a=n.value[n.value.length-1],u=await qe({parent:a,name:e});d.success(u),await D(a)};async function xe(e,a,l,u){const i=N.value[e][l],y=n.value[n.value.length-1];try{const V=y+"/"+name,Ne={parent:y,name:a.name,description:i},De=await He(Ne);d.success(De),await D(y)}catch{p("编辑失败！",{type:"error"})}w.value[e]=Object.assign({},w.value[e],{editing:!1,prop:""}),ke().then(()=>N.value[e].value=null)}const K=async e=>{const a=n.value[n.value.length-1];Oe({name:e,parent:a})};return{CreateDirFileHandle:ye,dialogVisible:S,uploadDialogVisible:T,handleClose:he,dialogEnterHandle:be,uploadChange:ge,fileList:$,nameClickHandle:D,breadcrumbList:n,namesList:h,ItemNameClickHandle:E,DataListResult:H,testHandle:oe,save:B,form:c,searchNameHandle:de,addNameHandle:fe,activeCurrent:m,setSave:ce,currentName:W,getNames:O,stopWatch:F,treeItemDeleteHandle:pe,onItemAddTopHandle:ve,deleteHandle:G,treeData:g,columns:me,dataList:v,rowClickHandle:ee,currentParent:s,currentRow:o,addRow:ae,addRowChilren:le,deleteRow:te,moveRowDown:se,moveRowUp:ne,autoExpand:P,loading:q}}export{Ke as useColumns};
