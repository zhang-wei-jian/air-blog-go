import{aC as H,U as oe,u as ce,av as ve,n as c,aw as fe,p as U,ax as y,ay as D,e as l,r,w as s,R as p,aa as M,aN as J,aB as de,P as ye,aO as be}from"./index-8391854f.js";import{E as N}from"./edit-pen-af58ba35.js";import{d as V}from"./check-3815600c.js";import{b as G}from"./browser-5e8f72a1.js";import{E as he}from"./index-46334353.js";import{u as me}from"./DialplanExtension-9e3aa3b0.js";const _e=()=>H.request("get","/api?action=GetDialplanExtensionNames"),Ie=f=>H.request("post",`/api?action=GetDialplanExtensionInfos&name=${f}`),K=(f,O)=>H.request("post",`/api?action=SetDialplanExtensionInfo&name=${f}`,{data:O}),ge=f=>H.request("post",`/api?action=DelDialplanExtensions&name=${f}`),Ee=me();function W(f){return typeof f=="function"||Object.prototype.toString.call(f)==="[object Object]"&&!be(f)}oe();ce();const{storeResultData:Q}=ve(Ee);function $e(){const f=c(!0),O=c(!0),I=c([]),z=c({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let X=[];const Y=[{label:"string",value:"string"},{label:"integer",value:"integer"},{label:"double",value:"double"},{label:"boolean",value:"boolean"},{label:"file",value:"file"},{label:"array",value:"array"},{label:"datetime",value:"datetime"},{label:"date",value:"date"},{label:"time",value:"time"},{label:"wday",value:"wday"}],Z=[{label:"Normal",value:"Normal"},{label:"NoEcho",value:"NoEcho"},{label:"Password",value:"Password"},{label:"PasswordEchoOnEdit",value:"PasswordEchoOnEdit"}],w=[{label:"boolean",value:"boolean"},{label:"number",value:"number"},{label:"string",value:"string"},{label:"object",value:"object"},{label:"array",value:"array"}];c();const d=c(),o=c();function A(t,e){for(const a of t){if(t&&t.includes(e))return{children:t,display:"属性",editable:!1,name:"parent"};if(a.children&&a.children.includes(e))return a;if(a.children){const n=A(a.children,e);if(n)return n}}return null}const ee=(t,e,a)=>{o.value=A(k.value,t),d.value=t};function te(){const t={name:"",key:Date.now()};Object.keys(d.value).forEach(e=>{t[e]=""}),t.name="new",t.key=Date.now(),o.value.children.push(t);try{y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ae(){if(d.value.type!=="object"){D.error("不是objcet不能添加子");return}const t={name:""};Object.keys(d.value).forEach(e=>{typeof t[e]!="object"&&(t[e]="")}),t.name="new",d.value.children||(d.value.children=[]),d.value.children.push(t);try{reqSetDialplanExtensionTemplate(k.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function le(){if(!o.value.children||!d.value)return;const t=o.value.children.indexOf(d.value);t!==-1&&o.value.children.splice(t,1);try{reqSetDialplanExtensionTemplate(k.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ne(){if(!o.value||!o.value.children||o.value.children.length<=1){D.warning("子节点不足，无法向上移动");return}const t=o.value.children.indexOf(d.value);if(t<=0){D.warning("当前行已经在顶部，无法再向上移动");return}const e=t-1;[o.value.children[t],o.value.children[e]]=[o.value.children[e],o.value.children[t]];try{reqSetDialplanExtensionTemplate(k.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function re(){if(!o.value||!o.value.children||o.value.children.length<=1){D.warning("子节点不足，无法向下移动");return}const t=o.value.children.indexOf(d.value);if(t>=o.value.children.length-1){D.warning("当前行已经在底部，无法再向下移动");return}const e=t+1;[o.value.children[t],o.value.children[e]]=[o.value.children[e],o.value.children[t]];try{reqSetDialplanExtensionTemplate(k.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}const S=c("0");async function P(t){O.value=!0;const e=await _e();if(I.value=e.result,t){const a=I.value.findIndex(u=>u===t||u.includes(t));q(I.value[a]);let n=Number(S.value);S.value=String(++n),G.nextTick(()=>{S.value=String(a)})}else I.value[0]&&q(I.value[0]);G.nextTick(()=>{f.value=!1,O.value=!1})}const g=c({}),$=c({}),b=c(-1),_=c(""),k=c(fe(X,!0)),R=U(()=>(t,e)=>{var a;return(a=g.value[t])==null?void 0:a[e]}),i=U(()=>(t,e)=>{var a,n;return((a=$.value[t])==null?void 0:a.editing)&&e.property===((n=$.value[t])==null?void 0:n.prop)}),v=U(()=>(t,e,a=!1)=>["cursor-pointer","ml-2","transition","delay-100",a?["hover:scale-110","hover:text-red-500"]:i.value(t,e)&&["scale-150","text-red-500"]]);U(()=>(t,e)=>["flex-bc","w-full","h-[32px]",t.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);const se=[{label:"编号",prop:"name",hide:function(t,e,a){return!0}},{label:"fueld or application",prop:"field",width:"260",fixed:!0,cellRenderer:({row:t,index:e,column:a})=>l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"参数名称",prop:"display",cellRenderer:({row:t,index:e,column:a})=>l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"类型",prop:"type",cellRenderer:({row:t,index:e,column:a})=>{let n;return l(r("el-select"),{modelValue:t[a.property],"onUpdate:modelValue":u=>t[a.property]=u,onChange:u=>B(u,t,e,a)},W(n=w.map(u=>l(J,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]})}},{label:"help",prop:"help",width:"160",cellRenderer:({row:t,index:e,column:a})=>l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:t[a.property],placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"默认值",prop:"value",cellRenderer:({row:t,index:e,column:a})=>l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"edit",prop:"input_type",cellRenderer:({row:t,index:e,column:a})=>{let n;return l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[s(l(r("el-select"),{modelValue:t[a.property],"onUpdate:modelValue":u=>t[a.property]=u,onChange:u=>B(u,t,e,a)},W(n=Y.map(u=>l(J,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]}),[[p,t.type!=="object"]])])}},{label:"tristate",prop:"input_tristate",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.input_type==="boolean"?"":"disable"}  `,onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[s(l(r("el-switch"),{modelValue:t[a.property],"onUpdate:modelValue":n=>t[a.property]=n,class:"ml-2",onChange:n=>B(n,t,e,a)},null),[[p,t.input_type==="boolean"]])])},{label:"min",prop:"input_min",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.input_type==="integer"?"":"disable"}  ${t.type==="object"?"disable":""}`,onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"max",prop:"input_max",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.input_type==="integer"?"":"disable"}`,onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])},{label:"echomode",prop:"echomode",cellRenderer:({row:t,index:e,column:a})=>{if(t.type==="object")return l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null);{let n;return l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.input_type==="integer"||t.input_type==="string"?"":"disable"}`},[s(l(r("el-select"),{modelValue:t[a.property],"onUpdate:modelValue":u=>t[a.property]=u,onChange:u=>B(u,t,e,a)},W(n=Z.map(u=>l(J,{key:u.value,label:u.label,value:u.value},null)))?n:{default:()=>[n]}),[[p,t.input_type==="integer"||t.input_type==="string"]])])}}},{label:"candidate",prop:"input_candidate",width:"160",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):(t.input_candidate||(t.input_candidate=[]),t.input_type!=="array"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l(he,{data:t.input_candidate,onChange:pe,onSubmit:n=>B(n.join(","),t,e,a),key:t.input_candidate},null))},{label:"selectonly",prop:"input_selectonly",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${t.input_type==="string"||t.input_type==="array"||t.input_candidate.length?"":"disable"}`,onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[s(l(r("el-switch"),{modelValue:t[a.property],"onUpdate:modelValue":n=>t[a.property]=n,class:"ml-2",onChange:n=>B(n,t,e,a)},null),[[p,t.input_type==="string"||t.input_type==="array"||t.input_candidate.length]])])},{label:"column",prop:"input_column",width:"220",cellRenderer:({row:t,index:e,column:a})=>t.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox   ${t.input_type==="array"?"":"disable"}`,style:" display:inline-flex; width:100%",onMouseenter:()=>h(t,e,a),onMouseleave:()=>m(e)},[l(r("el-tooltip"),{content:String(t[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[t[a.property]]),[[p,!i.value(e,a)]])]}),l(M,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:R.value(e,a.property),onInput:n=>C(n,e,a.property)},null),[[p,i.value(e,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(e,a),onClick:()=>j(e,t,a.property)},null),[[p,i.value(e,a)]]),s(l(r("iconify-icon-offline"),{icon:N,class:`${v.value(e,!0)} templateEditIcon`,onClick:()=>E(t,e,a)},null),[[p,b.value===e&&!i.value(e,a)&&_.value===a.property]])])}];function E(t,e,a){g.value[e]=Object.assign({},g.value[e],{[a.property]:t[a.property]}),$.value[e]=Object.assign({},$.value[e],{editing:!0,prop:a.property})}function h(t,e,a){b.value=e,_.value=a.property}function m(t){var e;_.value="",(e=g.value[t])!=null&&e.value?b.value=t:b.value=-1}function C(t,e,a){g.value[e][a]=t}async function j(t,e,a){e[a]=g.value[t][a];try{await reqSetDialplanExtensionTemplate(k.value),y(`编辑成功,${JSON.stringify(g.value[t][a])}`,{type:"success"})}catch{y("编辑失败！",{type:"error"})}$.value[t]=Object.assign({},$.value[t],{editing:!1,prop:""}),de().then(()=>g.value[t].value=null)}const B=async(t,e,a,n)=>{await E(e,a,n),await C(t,a,n.property),await j(a,e,n.property)},pe=t=>{},L=c(!1);let x=null;const q=async t=>{F.value=t,L.value=!1,x&&x();const e=await Ie(t),a=Object.keys(e.result);z.value=JSON.parse(JSON.stringify(e.result[a[0]])),Q.value=e.result[a[0]],x=ye(Q,()=>{L.value=!0},{deep:!0})},F=c(""),ie=()=>{},ue=async(t,e)=>{await K(t,e)},T=c({name:""});return{namesList:I,ItemNameClickHandle:q,DataListResult:z,testHandle:ie,save:L,setSave:ue,currentName:F,getNames:P,stopWatch:x,activeCurrent:S,deleteHandle:async t=>{const e=await ge(t);D.success(e.message),P()},form:T,searchNameHandle:async()=>{const t=T.value.name,e=I.value.findIndex(n=>n===t||n.includes(t));q(I.value[e]);let a=Number(S.value);S.value=String(++a),G.nextTick(()=>{S.value=String(e)})},addNameHandle:async()=>{const t={condition:[{field:"destination_number",regex:[],action:[],"anti-action":[],condition:[],"require-nested":!0,break:"on-true"}],continue:!0},e=await K(T.value.name,t);D.success(e.message),P(T.value.name),T.value.name=""},columns:se,dataList:k,rowClickHandle:ee,currentParent:o,currentRow:d,addRow:te,addRowChilren:ae,deleteRow:le,moveRowDown:re,moveRowUp:ne,autoExpand:f,loading:O}}export{$e as useColumns};
