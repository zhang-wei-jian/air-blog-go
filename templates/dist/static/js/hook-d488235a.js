import{av as de,n as c,aw as be,p as q,ax as y,ay as k,e as l,r,w as s,R as p,aa as R,aN as W,aB as he,P as me,aO as _e}from"./index-8391854f.js";import{E as D}from"./edit-pen-af58ba35.js";import{d as V}from"./check-3815600c.js";import{r as Ie,a as ge,b as K,c as Ce}from"./APIDialplanContext-cbf26d01.js";import{b as x}from"./browser-5e8f72a1.js";import{E as Ee}from"./index-46334353.js";import{u as je}from"./DialplanExtension-9e3aa3b0.js";const Se=je();function z(B){return typeof B=="function"||Object.prototype.toString.call(B)==="[object Object]"&&!_e(B)}const{storeResultData:ke}=de(Se);function Oe(){const B=c(!0),L=c(!0),I=c([]),J=c({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let Q=[];const X=[{label:"string",value:"string"},{label:"integer",value:"integer"},{label:"double",value:"double"},{label:"boolean",value:"boolean"},{label:"file",value:"file"},{label:"array",value:"array"},{label:"datetime",value:"datetime"},{label:"date",value:"date"},{label:"time",value:"time"},{label:"wday",value:"wday"}],Y=[{label:"Normal",value:"Normal"},{label:"NoEcho",value:"NoEcho"},{label:"Password",value:"Password"},{label:"PasswordEchoOnEdit",value:"PasswordEchoOnEdit"}],Z=[{label:"boolean",value:"boolean"},{label:"number",value:"number"},{label:"string",value:"string"},{label:"object",value:"object"},{label:"array",value:"array"}];c();const f=c(),o=c();function F(e,t){for(const a of e){if(e&&e.includes(t))return{children:e,display:"属性",editable:!1,name:"parent"};if(a.children&&a.children.includes(t))return a;if(a.children){const n=F(a.children,t);if(n)return n}}return null}const w=(e,t,a)=>{o.value=F(M.value,e),f.value=e};function ee(){const e={name:"",key:Date.now()};Object.keys(f.value).forEach(t=>{e[t]=""}),e.name="new",e.key=Date.now(),o.value.children.push(e);try{y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function te(){if(f.value.type!=="object"){k.error("不是objcet不能添加子");return}const e={name:""};Object.keys(f.value).forEach(t=>{typeof e[t]!="object"&&(e[t]="")}),e.name="new",f.value.children||(f.value.children=[]),f.value.children.push(e);try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ae(){if(!o.value.children||!f.value)return;const e=o.value.children.indexOf(f.value);e!==-1&&o.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function le(){if(!o.value||!o.value.children||o.value.children.length<=1){k.warning("子节点不足，无法向上移动");return}const e=o.value.children.indexOf(f.value);if(e<=0){k.warning("当前行已经在顶部，无法再向上移动");return}const t=e-1;[o.value.children[e],o.value.children[t]]=[o.value.children[t],o.value.children[e]];try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function ne(){if(!o.value||!o.value.children||o.value.children.length<=1){k.warning("子节点不足，无法向下移动");return}const e=o.value.children.indexOf(f.value);if(e>=o.value.children.length-1){k.warning("当前行已经在底部，无法再向下移动");return}const t=e+1;[o.value.children[e],o.value.children[t]]=[o.value.children[t],o.value.children[e]];try{reqSetDialplanExtensionTemplate(M.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}async function U(e){L.value=!0;const t=await Ie();if(I.value=t.result,e){const a=I.value.findIndex(i=>i===e||i.includes(e));P(I.value[a]);let n=Number(m.value);m.value=String(++n),x.nextTick(()=>{m.value=String(a)})}else{I.value[0]&&P(I.value[0]);let a=Number(m.value);m.value=String(++a),x.nextTick(()=>{m.value="0"})}x.nextTick(()=>{B.value=!1,L.value=!1})}const g=c({}),N=c({}),d=c(-1),_=c(""),M=c(be(Q,!0)),T=q(()=>(e,t)=>{var a;return(a=g.value[e])==null?void 0:a[t]}),u=q(()=>(e,t)=>{var a,n;return((a=N.value[e])==null?void 0:a.editing)&&t.property===((n=N.value[e])==null?void 0:n.prop)}),v=q(()=>(e,t,a=!1)=>["cursor-pointer","ml-2","transition","delay-100",a?["hover:scale-110","hover:text-red-500"]:u.value(e,t)&&["scale-150","text-red-500"]]);q(()=>(e,t)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);const re=[{label:"编号",prop:"name",hide:function(e,t,a){return!0}},{label:"fueld or application",prop:"field",width:"260",fixed:!0,cellRenderer:({row:e,index:t,column:a})=>l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"参数名称",prop:"display",cellRenderer:({row:e,index:t,column:a})=>l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"类型",prop:"type",cellRenderer:({row:e,index:t,column:a})=>{let n;return l(r("el-select"),{modelValue:e[a.property],"onUpdate:modelValue":i=>e[a.property]=i,onChange:i=>O(i,e,t,a)},z(n=Z.map(i=>l(W,{key:i.value,label:i.label,value:i.value},null)))?n:{default:()=>[n]})}},{label:"help",prop:"help",width:"160",cellRenderer:({row:e,index:t,column:a})=>l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:e[a.property],placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"默认值",prop:"value",cellRenderer:({row:e,index:t,column:a})=>l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"edit",prop:"input_type",cellRenderer:({row:e,index:t,column:a})=>{let n;return l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[s(l(r("el-select"),{modelValue:e[a.property],"onUpdate:modelValue":i=>e[a.property]=i,onChange:i=>O(i,e,t,a)},z(n=X.map(i=>l(W,{key:i.value,label:i.label,value:i.value},null)))?n:{default:()=>[n]}),[[p,e.type!=="object"]])])}},{label:"tristate",prop:"input_tristate",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="boolean"?"":"disable"}  `,onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[s(l(r("el-switch"),{modelValue:e[a.property],"onUpdate:modelValue":n=>e[a.property]=n,class:"ml-2",onChange:n=>O(n,e,t,a)},null),[[p,e.input_type==="boolean"]])])},{label:"min",prop:"input_min",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"?"":"disable"}  ${e.type==="object"?"disable":""}`,onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"max",prop:"input_max",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"?"":"disable"}`,onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])},{label:"echomode",prop:"echomode",cellRenderer:({row:e,index:t,column:a})=>{if(e.type==="object")return l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null);{let n;return l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="integer"||e.input_type==="string"?"":"disable"}`},[s(l(r("el-select"),{modelValue:e[a.property],"onUpdate:modelValue":i=>e[a.property]=i,onChange:i=>O(i,e,t,a)},z(n=Y.map(i=>l(W,{key:i.value,label:i.label,value:i.value},null)))?n:{default:()=>[n]}),[[p,e.input_type==="integer"||e.input_type==="string"]])])}}},{label:"candidate",prop:"input_candidate",width:"160",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):(e.input_candidate||(e.input_candidate=[]),e.input_type!=="array"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l(Ee,{data:e.input_candidate,onChange:se,onSubmit:n=>O(n.join(","),e,t,a),key:e.input_candidate},null))},{label:"selectonly",prop:"input_selectonly",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="string"||e.input_type==="array"||e.input_candidate.length?"":"disable"}`,onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[s(l(r("el-switch"),{modelValue:e[a.property],"onUpdate:modelValue":n=>e[a.property]=n,class:"ml-2",onChange:n=>O(n,e,t,a)},null),[[p,e.input_type==="string"||e.input_type==="array"||e.input_candidate.length]])])},{label:"column",prop:"input_column",width:"220",cellRenderer:({row:e,index:t,column:a})=>e.type==="object"?l("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):l("div",{class:`flex-bc w-full h-[32px] templateItemBox   ${e.input_type==="array"?"":"disable"}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,a),onMouseleave:()=>h(t)},[l(r("el-tooltip"),{content:String(e[a.property]),placement:"top"},{default:()=>[s(l("p",{class:"templateItemText"},[e[a.property]]),[[p,!u.value(t,a)]])]}),l(R,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[s(l(r("el-input"),{modelValue:T.value(t,a.property),onInput:n=>E(n,t,a.property)},null),[[p,u.value(t,a)]])]}),s(l(r("iconify-icon-offline"),{icon:V,class:v.value(t,a),onClick:()=>j(t,e,a.property)},null),[[p,u.value(t,a)]]),s(l(r("iconify-icon-offline"),{icon:D,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,a)},null),[[p,d.value===t&&!u.value(t,a)&&_.value===a.property]])])}];function C(e,t,a){g.value[t]=Object.assign({},g.value[t],{[a.property]:e[a.property]}),N.value[t]=Object.assign({},N.value[t],{editing:!0,prop:a.property})}function b(e,t,a){d.value=t,_.value=a.property}function h(e){var t;_.value="",(t=g.value[e])!=null&&t.value?d.value=e:d.value=-1}function E(e,t,a){g.value[t][a]=e}async function j(e,t,a){t[a]=g.value[e][a];try{await reqSetDialplanExtensionTemplate(M.value),y(`编辑成功,${JSON.stringify(g.value[e][a])}`,{type:"success"})}catch{y("编辑失败！",{type:"error"})}N.value[e]=Object.assign({},N.value[e],{editing:!1,prop:""}),he().then(()=>g.value[e].value=null)}const O=async(e,t,a,n)=>{await C(t,a,n),await E(e,a,n.property),await j(a,t,n.property)},se=e=>{},A=c(!1);let H=null;const P=async e=>{G.value=e;const t=await ge(e),a=Object.keys(t.result);J.value=JSON.parse(JSON.stringify(t.result[a[0]]));const n=J.value;S.value=n,A.value=!1,H&&H(),H=me(S,()=>{A.value=!0,x.nextTick(()=>{})},{deep:!0}),ke.value=t.result[a[0]]},G=c(""),pe=()=>{},ue=async(e,t)=>{const a=await K(e,S.value);k.success(a.message),U(e)},ie=async e=>{const t=e;t.state=!1,S.value=S.value.filter(a=>a!==e),S.value.push(t)},oe=(e,t)=>{S.value.splice(t,1)},S=c([{label:"---已启用---",leave:"on"},{label:"aa"},{label:"bb"},{label:"---未启用---",leave:"off"},{label:"dd"}]),ce=async()=>{const e=await K($.value.name,[]);k.success(e.message),U($.value.name),$.value.name=""},ve=async()=>{const e=$.value.name,t=I.value.findIndex(n=>n===e||n.includes(e));P(I.value[t]);let a=Number(m.value);m.value=String(++a),x.nextTick(()=>{m.value=String(t)})},fe=async e=>{const t=await Ce(e);k.success(t.message),U()},ye=async e=>{},m=c("0"),$=c({name:""});return{namesList:I,ItemNameClickHandle:P,DataListResult:J,testHandle:pe,save:A,setSave:ue,currentName:G,getNames:U,stopWatch:H,treeItemDeleteHandle:ie,onItemAddTopHandle:oe,addNameHandle:ce,form:$,deleteHandle:fe,switchTreeHandle:ye,activeCurrent:m,searchNameHandle:ve,treeData:S,columns:re,dataList:M,rowClickHandle:w,currentParent:o,currentRow:f,addRow:ee,addRowChilren:te,deleteRow:ae,moveRowDown:ne,moveRowUp:le,autoExpand:B,loading:L}}export{Oe as useColumns};
