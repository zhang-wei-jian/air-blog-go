import{av as ke,n as r,aw as Se,p as B,P as ae,a0 as Te,ax as p,ay as y,e as l,w as m,R as b,r as o,az as te,h as I,aA as le,aa as ne,F as S,aB as se}from"./index-8391854f.js";import{E as ue}from"./edit-pen-af58ba35.js";import{d as re}from"./check-3815600c.js";import{r as T,a as _e,b as Ae,c as Re,d as qe,e as Oe,f as He}from"./APIAudioFileDB-163abaae.js";import{r as Be,a as Me,b as Pe}from"./APIConfigFile-652f44ec.js";import{b as _}from"./browser-5e8f72a1.js";import{u as Ve}from"./DialplanExtension-9e3aa3b0.js";import"./axios-75d0e659.js";const ze=Ve(),{storeResultData:Le}=ke(ze);function Ze(){const U=r(!0),M=r(!0),N=r([]),P=r({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let ie=[];r();const v=r(),u=r();function J(e,a){for(const t of e){if(e&&e.includes(a))return{children:e,display:"属性",editable:!1,name:"parent"};if(t.children&&t.children.includes(a))return t;if(t.children){const s=J(t.children,a);if(s)return s}}return null}const oe=(e,a,t)=>{u.value=J(c.value,e),v.value=e};function ce(){const e={name:"",key:Date.now()};Object.keys(v.value).forEach(a=>{e[a]=""}),e.name="new",e.key=Date.now(),u.value.children.push(e);try{p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function pe(){if(v.value.type!=="object"){y.error("不是objcet不能添加子");return}const e={name:""};Object.keys(v.value).forEach(a=>{typeof e[a]!="object"&&(e[a]="")}),e.name="new",v.value.children||(v.value.children=[]),v.value.children.push(e);try{reqSetDialplanExtensionTemplate(c.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function ve(){if(!u.value.children||!v.value)return;const e=u.value.children.indexOf(v.value);e!==-1&&u.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(c.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function fe(){if(!u.value||!u.value.children||u.value.children.length<=1){y.warning("子节点不足，无法向上移动");return}const e=u.value.children.indexOf(v.value);if(e<=0){y.warning("当前行已经在顶部，无法再向上移动");return}const a=e-1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(c.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}function de(){if(!u.value||!u.value.children||u.value.children.length<=1){y.warning("子节点不足，无法向下移动");return}const e=u.value.children.indexOf(v.value);if(e>=u.value.children.length-1){y.warning("当前行已经在底部，无法再向下移动");return}const a=e+1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(c.value),p("编辑成功",{type:"success"})}catch{p("编辑失败！",{type:"error"})}}async function $(e){M.value=!0;const a=await Be();if(N.value=a.result,e){const t=N.value.findIndex(i=>i===e||i.includes(e));k(N.value[t]);let s=Number(h.value);h.value=String(++s),_.nextTick(()=>{h.value=String(t)})}else{N.value[0]&&k(N.value[0]);let t=Number(h.value);h.value=String(++t),_.nextTick(()=>{h.value="0"})}_.nextTick(()=>{U.value=!1,M.value=!1})}const g=r({}),D=r({}),w=r(-1),A=r(""),c=r(Se(ie,!0)),G=B(()=>(e,a)=>{var t;return(t=g.value[e])==null?void 0:t[a]}),f=B(()=>(e,a)=>{var t,s;return((t=D.value[e])==null?void 0:t.editing)&&a.property===((s=D.value[e])==null?void 0:s.prop)}),R=B(()=>(e,a,t=!1)=>["cursor-pointer","ml-2","transition","delay-100",t?["hover:scale-110","hover:text-red-500"]:f.value(e,a)&&["scale-150","text-red-500"]]);B(()=>(e,a)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);function K(e,a,t){g.value[a]=Object.assign({},g.value[a],{[t.property]:e[t.property]}),D.value[a]=Object.assign({},D.value[a],{editing:!0,prop:t.property})}function V(e,a,t){w.value=a,A.value=t.property}function z(e){var a;A.value="",(a=g.value[e])!=null&&a.value?w.value=e:w.value=-1}function Q(e,a,t){g.value[a][t]=e}const L=r(!1);let q=null;const k=async e=>{X.value=e;const a=await Me(e),t=Object.keys(a.result);P.value=JSON.parse(JSON.stringify(a.result[t[0]])),E.value=P.value,L.value=!1,q&&q(),q=ae(E,()=>{L.value=!0,_.nextTick(()=>{})},{deep:!0}),Le.value=a.result[t[0]]},X=r(""),ye=()=>{},he=async(e,a)=>{const t=await Pe(e,E.value);y.success(t.message),$(e),k(e)},me=async e=>{const a=e;a.state=!1,E.value=E.value.filter(t=>t.label!==e.label),E.value.push(a)},be=(e,a)=>{E.value.splice(a,1)},h=r("0"),ge=async()=>{const e=j.value.name,a=N.value.findIndex(s=>s===e||s.includes(e));k(N.value[a]);let t=Number(h.value);h.value=String(++t),_.nextTick(()=>{h.value=String(a)})},je=async()=>{},E=r(""),Ce=[{label:"Name",prop:"name",width:"260",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(S,null,[e.name!="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[e.type==="folder"&&m(l("p",{class:"templateItemText",onClick:()=>F(e[t.property])},[l(o("el-icon"),{color:"#409EFF"},{default:()=>[l(te,null,null)]}),l("span",null,null),I("    "),l("span",null,null),l("a",null,[I("  "),e[t.property]])]),[[b,!f.value(a,t)]]),e.type==="file"&&m(l("p",{class:"templateItemText"},[l(o("el-icon"),null,{default:()=>[l(le,null,null)]}),l("span",null,null),I("    "),l("span",null,null),e[t.property]]),[[b,!f.value(a,t)]]),l(ne,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[m(l(o("el-input"),{modelValue:G.value(a,t.property),onInput:s=>Q(s,a,t.property)},null),[[b,f.value(a,t)]])]}),m(l(o("iconify-icon-offline"),{icon:re,class:R.value(a,t),onClick:()=>Fe(a,e,t.property,e[t.property])},null),[[b,f.value(a,t)]]),m(l(o("iconify-icon-offline"),{icon:ue,class:`${R.value(a,!0)} templateEditIcon`,onClick:()=>K(e,a,t)},null),[[b,w.value===a&&!f.value(a,t)&&A.value===t.property]])]),e.name==="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:140px",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[m(l("p",{class:"templateItemText",onClick:()=>F(e[t.property])},[e.type==="folder"&&l(o("el-icon"),{color:"#409EFF"},{default:()=>[l(te,null,null)]}),e.type==="file"&&l(o("el-icon"),null,{default:()=>[l(le,null,null)]}),l("span",null,null),I("    "),l("span",null,null),l("a",null,[I("  "),e[t.property]])]),[[b,!f.value(a,t)]])])])},{label:"CreateTime",prop:"filemtime",width:"260",fixed:!0},{label:"Filesize",prop:"filesize",fixed:!0},{label:"Description",prop:"description",width:"260",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(S,null,[e.name!="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>V(e,a,t),onMouseleave:()=>z(a)},[m(l("p",{class:"templateItemText"},[e[t.property]]),[[b,!f.value(a,t)]]),l(ne,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[m(l(o("el-input"),{modelValue:G.value(a,t.property),onInput:s=>Q(s,a,t.property)},null),[[b,f.value(a,t)]])]}),m(l(o("iconify-icon-offline"),{icon:re,class:R.value(a,t),onClick:()=>xe(a,e,t.property,e[t.property])},null),[[b,f.value(a,t)]]),m(l(o("iconify-icon-offline"),{icon:ue,class:`${R.value(a,!0)} templateEditIcon`,onClick:()=>K(e,a,t)},null),[[b,w.value===a&&!f.value(a,t)&&A.value===t.property]])])])},{label:"Edit",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(S,null,[e.name!="..."&&l("div",null,[e.type==="folder"&&l(S,null,[l(o("el-Button"),{size:"small",type:"success",disabled:!0,onClick:()=>Z(e.name),style:"visibility: hidden"},{default:()=>[I("下载")]}),l(o("el-popconfirm"),{title:"会导致文件夹内所有文件删除,您确定要删除?",onConfirm:()=>W(e)},{reference:()=>l(o("el-button"),{size:"small",type:"danger"},{default:()=>[I("删除")]})})]),e.type==="file"&&l(S,null,[l(o("el-Button"),{size:"small",type:"success",onClick:()=>Z(e.name)},{default:()=>[I("下载")]}),l(o("el-popconfirm"),{title:"您确定要删除?",onConfirm:()=>W(e)},{reference:()=>l(o("el-button"),{size:"small",type:"danger"},{default:()=>[I("删除")]})})])])])}],n=r([]),F=async(e,a)=>{let t=n.value.join("/");if(t===e&&e!==""){const s=await T({dir:t});c.value=s,c.value.unshift({name:"...",type:"folder"});return}if(a=="nav"){const s=n.value.findIndex(d=>d===e);n.value=n.value.slice(0,s+1),t=n.value.slice(0,s+1).join("/");const i=await T({dir:t});c.value=i,n.value.length>0&&c.value.unshift({name:"...",type:"folder"});return}if(e==="..."){n.value.pop(),t=n.value.join("/");const s=await T({dir:t});c.value=s,n.value.length>0&&c.value.unshift({name:"...",type:"folder"});return}else if(e===""){const s=await T({dir:t});c.value=s,n.value=[];return}else{n.value.push(e),t=n.value.join("/");const s=await T({dir:t});c.value=s,c.value.unshift({name:"...",type:"folder"}),n.value[n.value.length-1]==e||n.value.push(e)}};ae(n,async()=>{});const j=Te({name:"",description:"",file:""}),Ie=async e=>{j.description="",j.name="",j.file="",Y.value=[],e==="upload"?H.value=!0:e==="create"&&(O.value=!0)},O=r(!1),H=r(!1),Y=r([]),Ne=async e=>{e==="upload"?H.value=!1:e==="create"&&(O.value=!1)},De=async e=>{let a=n.value.join("/"),t=n.value.join("/");if(t.startsWith("/")&&(t=t.substring(1)),e=="upload"){try{const s=n.value[n.value.length-1],i={parent:a,file:j.file,description:j.description},d=await _e(i);y.success(d),await F(a),H.value=!1}catch{p("请求失败",{type:"error"})}return}else{n.value[n.value.length-1];const s={name:"",description:"",parent:a};Object.assign(s,j);const i=await Ae(s);y.success(i),await F(a),O.value=!1}},Ee=async(e,a)=>{j.file=e.raw},W=async e=>{const a=e.name,t=e.type;let s=n.value.join("/");n.value[n.value.length-1];let i=n.value.join("/");i.startsWith("/")&&(i=i.substring(1));let d={parent:"",name:"",type:""};t==="folder"?d={parent:s,name:a,type:t}:t==="file"&&(d={parent:s,name:a,type:t});const C=await Re(d);y.success(C),await F(s)};async function Fe(e,a,t,s){const i=a.type,d=g.value[e][t];let C=n.value.join("/");C.startsWith("/")&&(C=C.substring(1));try{let x=n.value.join("/");const ee=n.value[n.value.length-1],we=await qe({parent:x,name:s,newName:d,type:i,newDir:x});y.success(we),await F(x)}catch{p("编辑失败！",{type:"error"})}D.value[e]=Object.assign({},D.value[e],{editing:!1,prop:""}),se().then(()=>g.value[e].value=null)}async function xe(e,a,t,s){let i=n.value.join("/");i.startsWith("/")&&(i=i.substring(1));const d=g.value[e][t];n.value[n.value.length-1];try{let C=n.value.join("/");const x={parent:C,name:a.name,description:d},ee=await Oe(x);y.success(ee),await F(C)}catch{p("编辑失败！",{type:"error"})}D.value[e]=Object.assign({},D.value[e],{editing:!1,prop:""}),se().then(()=>g.value[e].value=null)}const Z=async e=>{let a=n.value.join("/");n.value[n.value.length-1],He({name:e,parent:a})};return{CreateDirFileHandle:Ie,dialogVisible:O,uploadDialogVisible:H,handleClose:Ne,dialogEnterHandle:De,uploadChange:Ee,fileList:Y,nameClickHandle:F,breadcrumbList:n,namesList:N,ItemNameClickHandle:k,DataListResult:P,testHandle:ye,save:L,form:j,searchNameHandle:ge,addNameHandle:je,activeCurrent:h,setSave:he,currentName:X,getNames:$,stopWatch:q,treeItemDeleteHandle:me,onItemAddTopHandle:be,deleteHandle:W,treeData:E,columns:Ce,dataList:c,rowClickHandle:oe,currentParent:u,currentRow:v,addRow:ce,addRowChilren:pe,deleteRow:ve,moveRowDown:de,moveRowUp:fe,autoExpand:U,loading:M}}export{Ze as useColumns};
