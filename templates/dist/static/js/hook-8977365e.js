import{aC as N,n as m,aw as w,p as U,ax as y,ay as O,e as a,r,w as p,R as u,aa as E,aN as x,aB as ee,aO as te}from"./index-8391854f.js";import{E as V}from"./edit-pen-af58ba35.js";import{d as k}from"./check-3815600c.js";import{b as le}from"./browser-5e8f72a1.js";import{E as ae}from"./index-46334353.js";const ne=_=>N.request("post","/api?action=GetTemplateInfos&name=AcdTemplate",{}),S=_=>N.request("post","/api?action=SetTemplateInfo&name=AcdTemplate",{data:{name:"root",children:_}});function A(_){return typeof _=="function"||Object.prototype.toString.call(_)==="[object Object]"&&!te(_)}function oe(){const _=m(!0),$=m(!0);let q=[];const L=[{label:"string",value:"string"},{label:"integer",value:"integer"},{label:"double",value:"double"},{label:"boolean",value:"boolean"},{label:"file",value:"file"},{label:"array",value:"array"},{label:"datetime",value:"datetime"},{label:"date",value:"date"},{label:"time",value:"time"},{label:"wday",value:"wday"}],H=[{label:"Normal",value:0},{label:"NoEcho",value:1},{label:"Password",value:2},{label:"PasswordEchoOnEdit",value:3}],G=[{label:"boolean",value:"boolean"},{label:"number",value:"number"},{label:"string",value:"string"},{label:"object",value:"object"},{label:"array",value:"array"}];function D(e){const t=()=>Math.random().toString(36).substr(2,9);return e.map(l=>{const n={...l,key:t()};return n.children&&n.children.length>0&&(n.children=D(n.children)),n})}m();const c=m(),s=m();function P(e,t){for(const l of e){if(e&&e.includes(t))return{children:e,display:"属性",editable:!1,name:"parent"};if(l.children&&l.children.includes(t))return l;if(l.children){const n=P(l.children,t);if(n)return n}}return null}const J=(e,t,l)=>{s.value=P(f.value,e),c.value=e};function K(){if(c.value){const e={name:"",key:Date.now(),children:[]};Object.keys(c.value).forEach(t=>{e[t]="",Array.isArray(c.value[t])?e[t]=[]:Array.isArray(c.value[t])?e[t]={}:e[t]=""}),e.name="new",e.key=Date.now(),s.value.children.push(e)}else{const e={display:"",editable:"",help:"",input_candidate:"",input_echomode:"",input_mask:"",input_type:"",key:0,name:"new",type:"",value:""};e.name="new",e.key=Date.now(),f.value.push(e)}try{S(f.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function z(){if(c.value.type!=="object"){O.error("不是objcet不能添加子");return}const e={name:""};Object.keys(c.value).forEach(t=>{typeof e[t]!="object"&&(e[t]="")}),e.name="new",c.value.children||(c.value.children=[]),c.value.children.push(e);try{S(f.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function F(){if(!s.value.children||!c.value)return;const e=s.value.children.indexOf(c.value);e!==-1&&s.value.children.splice(e,1);try{S(f.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}s.value=null,c.value=null}function Q(){if(!s.value||!s.value.children||s.value.children.length<=1){O.warning("子节点不足，无法向上移动");return}const e=s.value.children.indexOf(c.value);if(e<=0){O.warning("当前行已经在顶部，无法再向上移动");return}const t=e-1;[s.value.children[e],s.value.children[t]]=[s.value.children[t],s.value.children[e]];try{S(f.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}function W(){if(!s.value||!s.value.children||s.value.children.length<=1){O.warning("子节点不足，无法向下移动");return}const e=s.value.children.indexOf(c.value);if(e>=s.value.children.length-1){O.warning("当前行已经在底部，无法再向下移动");return}const t=e+1;[s.value.children[e],s.value.children[t]]=[s.value.children[t],s.value.children[e]];try{S(f.value),y("编辑成功",{type:"success"})}catch{y("编辑失败！",{type:"error"})}}async function X(){$.value=!0;const e=await ne();f.value=e.result.AcdTemplate.children,f.value=D(f.value),le.nextTick(()=>{_.value=!1,$.value=!1})}const g=m({}),R=m({}),d=m(-1),I=m(""),f=m(w(q,!0));X();const M=U(()=>(e,t)=>{var l;return(l=g.value[e])==null?void 0:l[t]}),i=U(()=>(e,t)=>{var l,n;return((l=R.value[e])==null?void 0:l.editing)&&t.property===((n=R.value[e])==null?void 0:n.prop)}),v=U(()=>(e,t,l=!1)=>["cursor-pointer","ml-2","transition","delay-100",l?["hover:scale-110","hover:text-red-500"]:i.value(e,t)&&["scale-150","text-red-500"]]);U(()=>(e,t)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);const Y=[{label:"编号",prop:"name",hide:function(e,t,l){return!0}},{label:"参数字段",prop:"name",width:"260",fixed:!0,cellRenderer:({row:e,index:t,column:l})=>a("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"参数名称",prop:"display",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"类型",prop:"type",cellRenderer:({row:e,index:t,column:l})=>{let n;return a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":o=>e[l.property]=o,onChange:o=>T(o,e,t,l)},A(n=G.map(o=>a(x,{key:o.value,label:o.label,value:o.value},null)))?n:{default:()=>[n]})}},{label:"help",prop:"help",width:"160",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:"flex-bc  templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:e[l.property],placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"默认值",prop:"value",cellRenderer:({row:e,index:t,column:l})=>a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"edit",prop:"input_type",cellRenderer:({row:e,index:t,column:l})=>{let n;return a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.type==="object"?"disable":""}`,style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[p(a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":o=>e[l.property]=o,onChange:o=>T(o,e,t,l)},A(n=L.map(o=>a(x,{key:o.value,label:o.label,value:o.value},null)))?n:{default:()=>[n]}),[[u,e.type!=="object"]])])}},{label:"tristate",prop:"input_tristate",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_type!=="boolean"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:`flex-bc w-full h-[32px] templateItemBox  ${e.input_type==="boolean"?"":"disable"}  `,onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[p(a(r("el-switch"),{modelValue:e[l.property],"onUpdate:modelValue":n=>e[l.property]=n,class:"ml-2",onChange:n=>T(n,e,t,l)},null),[[u,e.input_type==="boolean"]])])},{label:"min",prop:"input_min",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_type!=="integer"&&e.input_type!=="double"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:"flex-bc w-full h-[32px] templateItemBox  ",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{type:"number",modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"max",prop:"input_max",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_type!=="integer"&&e.input_type!=="double"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:"flex-bc w-full h-[32px] templateItemBox  ",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{type:"number",modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])},{label:"echomode",prop:"input_echomode",cellRenderer:({row:e,index:t,column:l})=>{if(e.type==="object")return a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null);if(e.input_type!=="string")return a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null);{let n;return a("div",{class:"flex-bc w-full h-[32px] templateItemBox  "},[p(a(r("el-select"),{modelValue:e[l.property],"onUpdate:modelValue":o=>e[l.property]=o,onChange:o=>T(o,e,t,l)},A(n=H.map(o=>a(x,{key:o.value,label:o.label,value:o.value},null)))?n:{default:()=>[n]}),[[u,e.input_type==="integer"||e.input_type==="string"]])])}}},{label:"candidate",prop:"input_candidate",width:"160",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_type!=="string"&&e.input_type!=="array"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a(ae,{data:e.input_candidate,onChange:Z,onSubmit:n=>T(n.join(","),e,t,l),key:e.input_candidate},null)},{label:"selectonly",prop:"input_selectonly",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_candidate===""?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:"flex-bc w-full h-[32px] templateItemBox ",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[p(a(r("el-switch"),{modelValue:e[l.property],"onUpdate:modelValue":n=>e[l.property]=n,class:"ml-2",onChange:n=>T(n,e,t,l)},null),[[u,e.input_type==="string"||e.input_type==="array"||e.input_candidate]])])},{label:"column",prop:"input_column",width:"220",cellRenderer:({row:e,index:t,column:l})=>e.type==="object"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):e.input_type!=="array"?a("div",{class:"flex-bc w-full h-[32px] templateItemBox  disable "},null):a("div",{class:"flex-bc w-full h-[32px] templateItemBox  ",style:" display:inline-flex; width:100%",onMouseenter:()=>b(e,t,l),onMouseleave:()=>h(t)},[a(r("el-tooltip"),{content:String(e[l.property]),placement:"top"},{default:()=>[p(a("p",{class:"templateItemText"},[e[l.property]]),[[u,!i.value(t,l)]])]}),a(E,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[p(a(r("el-input"),{modelValue:M.value(t,l.property),onInput:n=>j(n,t,l.property)},null),[[u,i.value(t,l)]])]}),p(a(r("iconify-icon-offline"),{icon:k,class:v.value(t,l),onClick:()=>B(t,e,l.property)},null),[[u,i.value(t,l)]]),p(a(r("iconify-icon-offline"),{icon:V,class:`${v.value(t,!0)} templateEditIcon`,onClick:()=>C(e,t,l)},null),[[u,d.value===t&&!i.value(t,l)&&I.value===l.property]])])}];function C(e,t,l){g.value[t]=Object.assign({},g.value[t],{[l.property]:e[l.property]}),R.value[t]=Object.assign({},R.value[t],{editing:!0,prop:l.property})}function b(e,t,l){d.value=t,I.value=l.property}function h(e){var t;I.value="",(t=g.value[e])!=null&&t.value?d.value=e:d.value=-1}function j(e,t,l){g.value[t][l]=e}async function B(e,t,l){t[l]=g.value[e][l];try{await S(f.value),y(`编辑成功,${JSON.stringify(g.value[e][l])}`,{type:"success"})}catch{y("编辑失败！",{type:"error"})}R.value[e]=Object.assign({},R.value[e],{editing:!1,prop:""}),ee().then(()=>g.value[e].value=null)}const T=async(e,t,l,n)=>{await C(t,l,n),await j(e,l,n.property),await B(l,t,n.property)},Z=e=>{};return{columns:Y,dataList:f,rowClickHandle:J,currentParent:s,currentRow:c,addRow:K,addRowChilren:z,deleteRow:F,moveRowDown:W,moveRowUp:Q,autoExpand:_,loading:$}}export{oe as useColumns};
