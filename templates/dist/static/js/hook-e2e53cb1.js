import{av as Ie,n as i,aw as Ee,p as H,P as Q,a0 as Fe,ax as d,ay as f,e as l,w as D,R as I,r as c,az as X,h as y,aA as Y,F as w,aa as Ne,aB as we}from"./index-8391854f.js";import{E as ke}from"./edit-pen-af58ba35.js";import{d as Se}from"./check-3815600c.js";import{r as k,a as Te,b as Ae,c as Re,d as qe,e as He}from"./APIAudioFile-cccadfa5.js";import{r as Oe,a as Be,b as Z}from"./APIConfigFile-652f44ec.js";import{b as S}from"./browser-5e8f72a1.js";import{u as Me}from"./DialplanExtension-9e3aa3b0.js";import"./axios-75d0e659.js";const _e=Me(),{storeResultData:Pe}=Ie(_e);function Ke(){const W=i(!0),O=i(!0),b=i([]),B=i({condition:[{field:"regex",regex:[{field:"destination_number"},{}],expression:"any",action:[{application:"bgsystem",data:"adfad",inline:!1}],"anti-action":[{inline:!1}],condition:[{}]},{action:[{inline:!0}]}],continue:!0});let ee=[];i();const p=i(),u=i();function U(e,a){for(const t of e){if(e&&e.includes(a))return{children:e,display:"属性",editable:!1,name:"parent"};if(t.children&&t.children.includes(a))return t;if(t.children){const s=U(t.children,a);if(s)return s}}return null}const ae=(e,a,t)=>{u.value=U(o.value,e),p.value=e};function te(){const e={name:"",key:Date.now()};Object.keys(p.value).forEach(a=>{e[a]=""}),e.name="new",e.key=Date.now(),u.value.children.push(e);try{d("编辑成功",{type:"success"})}catch{d("编辑失败！",{type:"error"})}}function le(){if(p.value.type!=="object"){f.error("不是objcet不能添加子");return}const e={name:""};Object.keys(p.value).forEach(a=>{typeof e[a]!="object"&&(e[a]="")}),e.name="new",p.value.children||(p.value.children=[]),p.value.children.push(e);try{reqSetDialplanExtensionTemplate(o.value),d("编辑成功",{type:"success"})}catch{d("编辑失败！",{type:"error"})}}function ne(){if(!u.value.children||!p.value)return;const e=u.value.children.indexOf(p.value);e!==-1&&u.value.children.splice(e,1);try{reqSetDialplanExtensionTemplate(o.value),d("编辑成功",{type:"success"})}catch{d("编辑失败！",{type:"error"})}}function se(){if(!u.value||!u.value.children||u.value.children.length<=1){f.warning("子节点不足，无法向上移动");return}const e=u.value.children.indexOf(p.value);if(e<=0){f.warning("当前行已经在顶部，无法再向上移动");return}const a=e-1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(o.value),d("编辑成功",{type:"success"})}catch{d("编辑失败！",{type:"error"})}}function ue(){if(!u.value||!u.value.children||u.value.children.length<=1){f.warning("子节点不足，无法向下移动");return}const e=u.value.children.indexOf(p.value);if(e>=u.value.children.length-1){f.warning("当前行已经在底部，无法再向下移动");return}const a=e+1;[u.value.children[e],u.value.children[a]]=[u.value.children[a],u.value.children[e]];try{reqSetDialplanExtensionTemplate(o.value),d("编辑成功",{type:"success"})}catch{d("编辑失败！",{type:"error"})}}async function M(e){O.value=!0;const a=await Oe();if(b.value=a.result,e){const t=b.value.findIndex(r=>r===e||r.includes(e));F(b.value[t]);let s=Number(h.value);h.value=String(++s),S.nextTick(()=>{h.value=String(t)})}else{b.value[0]&&F(b.value[0]);let t=Number(h.value);h.value=String(++t),S.nextTick(()=>{h.value="0"})}S.nextTick(()=>{W.value=!1,O.value=!1})}const j=i({}),E=i({}),T=i(-1),_=i(""),o=i(Ee(ee,!0)),ie=H(()=>(e,a)=>{var t;return(t=j.value[e])==null?void 0:t[a]}),g=H(()=>(e,a)=>{var t,s;return((t=E.value[e])==null?void 0:t.editing)&&a.property===((s=E.value[e])==null?void 0:s.prop)}),J=H(()=>(e,a,t=!1)=>["cursor-pointer","ml-2","transition","delay-100",t?["hover:scale-110","hover:text-red-500"]:g.value(e,a)&&["scale-150","text-red-500"]]);H(()=>(e,a)=>["flex-bc","w-full","h-[32px]",e.hasChildren?["hover:scale-110","hover:text-red-500"]:[""]]);function re(e,a,t){j.value[a]=Object.assign({},j.value[a],{[t.property]:e[t.property]}),E.value[a]=Object.assign({},E.value[a],{editing:!0,prop:t.property})}function P(e,a,t){T.value=a,_.value=t.property}function z(e){var a;_.value="",(a=j.value[e])!=null&&a.value?T.value=e:T.value=-1}function oe(e,a,t){j.value[a][t]=e}const V=i(!1);let A=null;const F=async e=>{$.value=e;const a=await Be(e),t=Object.keys(a.result);B.value=JSON.parse(JSON.stringify(a.result[t[0]])),x.value=B.value,V.value=!1,A&&A(),A=Q(x,()=>{V.value=!0,S.nextTick(()=>{})},{deep:!0}),Pe.value=a.result[t[0]]},$=i(""),ce=()=>{},pe=async(e,a)=>{const t=await Z(e,x.value);f.success(t.message),M(e),F(e)},ve=async e=>{const a=e;a.state=!1,x.value=x.value.filter(t=>t.label!==e.label),x.value.push(a)},de=(e,a)=>{x.value.splice(a,1)},h=i("0"),fe=async()=>{const e=v.value.name,a=b.value.findIndex(s=>s===e||s.includes(e));F(b.value[a]);let t=Number(h.value);h.value=String(++t),S.nextTick(()=>{h.value=String(a)})},he=async()=>{const e=await Z(v.value.name,"");f.success(e.message),M(v.value.name),v.value.name=""},x=i(""),me=[{label:"Name",prop:"name",width:"260",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(w,null,[e.name!="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>P(e,a,t),onMouseleave:()=>z(a)},[e.type==="folder"&&D(l("p",{class:"templateItemText",onClick:()=>C(e[t.property])},[l(c("el-icon"),{color:"#409EFF"},{default:()=>[l(X,null,null)]}),l("span",null,null),y("    "),l("span",null,null),l("a",null,[y("  "),e[t.property]])]),[[I,!g.value(a,t)]]),e.type==="file"&&D(l("p",{class:"templateItemText"},[l(c("el-icon"),null,{default:()=>[l(Y,null,null)]}),l("span",null,null),y("    "),l("span",null,null),e[t.property]]),[[I,!g.value(a,t)]])]),e.name==="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:140px",onMouseenter:()=>P(e,a,t),onMouseleave:()=>z(a)},[D(l("p",{class:"templateItemText",onClick:()=>C(e[t.property])},[e.type==="folder"&&l(c("el-icon"),{color:"#409EFF"},{default:()=>[l(X,null,null)]}),e.type==="file"&&l(c("el-icon"),null,{default:()=>[l(Y,null,null)]}),l("span",null,null),y("    "),l("span",null,null),l("a",null,[y("  "),e[t.property]])]),[[I,!g.value(a,t)]])])])},{label:"CreateTime",prop:"filemtime",width:"260",fixed:!0},{label:"Filesize",prop:"filesize",fixed:!0},{label:"Description",prop:"description",width:"260",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(w,null,[e.name!="..."&&l("div",{class:"flex-bc h-[32px] templateItemBox",style:" display:inline-flex; width:100%",onMouseenter:()=>P(e,a,t),onMouseleave:()=>z(a)},[D(l("p",{class:"templateItemText"},[e[t.property]]),[[I,!g.value(a,t)]]),l(Ne,{"enter-active-class":"animate__animated animate__fadeInUp animate__faster"},{default:()=>[D(l(c("el-input"),{modelValue:ie.value(a,t.property),onInput:s=>oe(s,a,t.property)},null),[[I,g.value(a,t)]])]}),D(l(c("iconify-icon-offline"),{icon:Se,class:J.value(a,t),onClick:()=>je(a,e,t.property,e[t.property])},null),[[I,g.value(a,t)]]),D(l(c("iconify-icon-offline"),{icon:ke,class:`${J.value(a,!0)} templateEditIcon`,onClick:()=>re(e,a,t)},null),[[I,T.value===a&&!g.value(a,t)&&_.value===t.property]])])])},{label:"Edit",prop:"description",fixed:!0,cellRenderer:({row:e,index:a,column:t})=>l(w,null,[e.name!="..."&&l("div",null,[e.type==="folder"&&l(w,null,[l(c("el-Button"),{size:"small",type:"success",disabled:!0,onClick:()=>K(e.name),style:"visibility: hidden"},{default:()=>[y("下载")]}),l(c("el-popconfirm"),{title:"会导致文件夹内所有文件删除,您确定要删除?",onConfirm:()=>L(e)},{reference:()=>l(c("el-button"),{size:"small",type:"danger"},{default:()=>[y("删除")]})})]),e.type==="file"&&l(w,null,[l(c("el-Button"),{size:"small",type:"success",onClick:()=>K(e.name)},{default:()=>[y("下载")]}),l(c("el-popconfirm"),{title:"您确定要删除?",onConfirm:()=>L(e)},{reference:()=>l(c("el-button"),{size:"small",type:"danger"},{default:()=>[y("删除")]})})])])])}],n=i([]),C=async(e,a)=>{let t=n.value.join("/");if(t===e&&e!==""){const s=await k({dir:t});o.value=s,o.value.unshift({name:"...",type:"folder"});return}if(a=="nav"){const s=n.value.findIndex(m=>m===e);n.value=n.value.slice(0,s+1),t=n.value.slice(0,s+1).join("/");const r=await k({dir:t});o.value=r,n.value.length>0&&o.value.unshift({name:"...",type:"folder"});return}if(e==="..."){n.value.pop(),t=n.value.join("/");const s=await k({dir:t});o.value=s,n.value.length>0&&o.value.unshift({name:"...",type:"folder"});return}else if(e===""){const s=await k({dir:t});o.value=s,n.value=[];return}else{n.value.push(e),t=n.value.join("/");const s=await k({dir:t});o.value=s,o.value.unshift({name:"...",type:"folder"}),n.value[n.value.length-1]==e||n.value.push(e)}};Q(n,async()=>{});const v=Fe({name:"",description:"",file:""}),ye=async e=>{v.description="",v.name="",v.file="",G.value=[],e==="upload"?q.value=!0:e==="create"&&(R.value=!0)},R=i(!1),q=i(!1),G=i([]),be=async e=>{e==="upload"?q.value=!1:e==="create"&&(R.value=!1)},ge=async e=>{let a=n.value.join("/"),t=n.value.join("/");if(t.startsWith("/")&&(t=t.substring(1)),e=="upload"){try{const s=n.value[n.value.length-1],r={parent:a,file:v.file,description:v.description},m=await Te(r);f.success(m),await C(a),q.value=!1}catch{d("请求失败",{type:"error"})}return}else{n.value[n.value.length-1];const s={name:"",description:"",parent:a};Object.assign(s,v);const r=await Ae(s);f.success(r),await C(a),R.value=!1}},xe=async(e,a)=>{v.file=e.raw},L=async e=>{const a=e.name,t=e.type;let s=n.value.join("/");n.value[n.value.length-1];let r=n.value.join("/");r.startsWith("/")&&(r=r.substring(1));let m={parent:"",name:"",type:""};t==="folder"?m={parent:s,name:a,type:t}:t==="file"&&(m={parent:s,name:a,type:t});const N=await Re(m);f.success(N),await C(s)};async function je(e,a,t,s){let r=n.value.join("/");r.startsWith("/")&&(r=r.substring(1));const m=j.value[e][t];n.value[n.value.length-1];try{let N=n.value.join("/");const Ce={parent:N,name:a.name,description:m},De=await qe(Ce);f.success(De),await C(N)}catch{d("编辑失败！",{type:"error"})}E.value[e]=Object.assign({},E.value[e],{editing:!1,prop:""}),we().then(()=>j.value[e].value=null)}const K=async e=>{let a=n.value.join("/");n.value[n.value.length-1],He({name:e,parent:a})};return{CreateDirFileHandle:ye,dialogVisible:R,uploadDialogVisible:q,handleClose:be,dialogEnterHandle:ge,uploadChange:xe,fileList:G,nameClickHandle:C,breadcrumbList:n,namesList:b,ItemNameClickHandle:F,DataListResult:B,testHandle:ce,save:V,form:v,searchNameHandle:fe,addNameHandle:he,activeCurrent:h,setSave:pe,currentName:$,getNames:M,stopWatch:A,treeItemDeleteHandle:ve,onItemAddTopHandle:de,deleteHandle:L,treeData:x,columns:me,dataList:o,rowClickHandle:ae,currentParent:u,currentRow:p,addRow:te,addRowChilren:le,deleteRow:ne,moveRowDown:ue,moveRowUp:se,autoExpand:W,loading:O}}export{Ke as useColumns};
